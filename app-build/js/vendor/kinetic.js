var Kinetic={};(function(){Kinetic.version="4.3.3",Kinetic.Filters={},Kinetic.Plugins={},Kinetic.Global={stages:[],idCounter:0,ids:{},names:{},shapes:{},warn:function(e){window.console&&console.warn&&console.warn("Kinetic warning: "+e)},extend:function(e,r){for(var o in r.prototype)o in e.prototype||(e.prototype[o]=r.prototype[o])},_addId:function(e,r){void 0!==r&&(this.ids[r]=e)},_removeId:function(e){void 0!==e&&delete this.ids[e]},_addName:function(e,r){void 0!==r&&(void 0===this.names[r]&&(this.names[r]=[]),this.names[r].push(e))},_removeName:function(e,r){if(void 0!==e){var o=this.names[e];if(void 0!==o){for(var i=0;o.length>i;i++){var T=o[i];T._id===r&&o.splice(i,1)}0===o.length&&delete this.names[e]}}}}})(),function(e,r){"object"==typeof exports?module.exports=r():"function"==typeof define&&define.amd?define(r):e.returnExports=r()}(this,function(){return Kinetic}),function(){Kinetic.Type={_isElement:function(e){return!!e&&1==e.nodeType},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isObject:function(e){return!!e&&e.constructor==Object},_isArray:function(e){return"[object Array]"==Object.prototype.toString.call(e)},_isNumber:function(e){return"[object Number]"==Object.prototype.toString.call(e)},_isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},_hasMethods:function(e){var r=[];for(var o in e)this._isFunction(e[o])&&r.push(o);return r.length>0},_isInDocument:function(e){for(;e=e.parentNode;)if(e==document)return!0;return!1},_getXY:function(e){if(this._isNumber(e))return{x:e,y:e};if(this._isArray(e)){if(1===e.length){var r=e[0];if(this._isNumber(r))return{x:r,y:r};if(this._isArray(r))return{x:r[0],y:r[1]};if(this._isObject(r))return r}else if(e.length>=2)return{x:e[0],y:e[1]}}else if(this._isObject(e))return e;return null},_getSize:function(e){if(this._isNumber(e))return{width:e,height:e};if(this._isArray(e))if(1===e.length){var r=e[0];if(this._isNumber(r))return{width:r,height:r};if(this._isArray(r)){if(r.length>=4)return{width:r[2],height:r[3]};if(r.length>=2)return{width:r[0],height:r[1]}}else if(this._isObject(r))return r}else{if(e.length>=4)return{width:e[2],height:e[3]};if(e.length>=2)return{width:e[0],height:e[1]}}else if(this._isObject(e))return e;return null},_getPoints:function(e){if(void 0===e)return[];if(this._isArray(e[0])){for(var r=[],o=0;e.length>o;o++)r.push({x:e[o][0],y:e[o][1]});return r}if(this._isObject(e[0]))return e;for(var r=[],o=0;e.length>o;o+=2)r.push({x:e[o],y:e[o+1]});return r},_getImage:function(e,r){if(e)if(this._isElement(e))r(e);else if(this._isString(e)){var o=new Image;o.onload=function(){r(o)},o.src=e}else if(e.data){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var T=i.getContext("2d");T.putImageData(e,0,0);var u=i.toDataURL(),o=new Image;o.onload=function(){r(o)},o.src=u}else r(null);else r(null)},_rgbToHex:function(e,r,o){return((1<<24)+(e<<16)+(r<<8)+o).toString(16).slice(1)},_hexToRgb:function(e){var r=parseInt(e,16);return{r:255&r>>16,g:255&r>>8,b:255&r}},_getRandomColorKey:function(){var e=Math.round(255*Math.random()),r=Math.round(255*Math.random()),o=Math.round(255*Math.random());return this._rgbToHex(e,r,o)},_merge:function(e,r){var o=this._clone(r);for(var i in e)o[i]=this._isObject(e[i])?this._merge(e[i],o[i]):e[i];return o},_clone:function(e){var r={};for(var o in e)r[o]=this._isObject(e[o])?this._clone(e[o]):e[o];return r},_degToRad:function(e){return e*Math.PI/180},_radToDeg:function(e){return 180*e/Math.PI}}}(),function(){var e=document.createElement("canvas"),r=e.getContext("2d"),o=window.devicePixelRatio||1,i=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1,T=o/i;Kinetic.Canvas=function(e,r,o){this.pixelRatio=o||T,this.width=e,this.height=r,this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.setSize(e||0,r||0)},Kinetic.Canvas.prototype={clear:function(){var e=this.getContext(),r=this.getElement();e.clearRect(0,0,r.width,r.height)},getElement:function(){return this.element},getContext:function(){return this.context},setWidth:function(e){this.width=e,this.element.width=e*this.pixelRatio,this.element.style.width=e+"px"},setHeight:function(e){this.height=e,this.element.height=e*this.pixelRatio,this.element.style.height=e+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(e,r){this.setWidth(e),this.setHeight(r)},toDataURL:function(e,r){try{return this.element.toDataURL(e,r)}catch(o){try{return this.element.toDataURL()}catch(o){return Kinetic.Global.warn("Unable to get data URL. "+o.message),""}}},fill:function(e){e.getFillEnabled()&&this._fill(e)},stroke:function(e){e.getStrokeEnabled()&&this._stroke(e)},fillStroke:function(e){var r=e.getFillEnabled();r&&this._fill(e),e.getStrokeEnabled()&&this._stroke(e,e.hasShadow()&&e.hasFill()&&r)},applyShadow:function(e,r){var o=this.context;o.save(),this._applyShadow(e),r(),o.restore(),r()},_applyLineCap:function(e){var r=e.getLineCap();r&&(this.context.lineCap=r)},_applyOpacity:function(e){var r=e.getAbsoluteOpacity();1!==r&&(this.context.globalAlpha=r)},_applyLineJoin:function(e){var r=e.getLineJoin();r&&(this.context.lineJoin=r)},_applyAncestorTransforms:function(e){var r=this.context;e._eachAncestorReverse(function(e){var o=e.getTransform(),i=o.getMatrix();r.transform(i[0],i[1],i[2],i[3],i[4],i[5])},!0)}},Kinetic.SceneCanvas=function(e,r,o){Kinetic.Canvas.call(this,e,r,o)},Kinetic.SceneCanvas.prototype={setWidth:function(e){var r=this.pixelRatio;Kinetic.Canvas.prototype.setWidth.call(this,e),this.context.scale(r,r)},setHeight:function(e){var r=this.pixelRatio;Kinetic.Canvas.prototype.setHeight.call(this,e),this.context.scale(r,r)},_fillColor:function(e){var r=this.context,o=e.getFill();r.fillStyle=o,e._fillFunc(r)},_fillPattern:function(e){var r=this.context,o=e.getFillPatternImage(),i=e.getFillPatternX(),T=e.getFillPatternY(),u=e.getFillPatternScale(),v=e.getFillPatternRotation(),b=e.getFillPatternOffset(),C=e.getFillPatternRepeat();(i||T)&&r.translate(i||0,T||0),v&&r.rotate(v),u&&r.scale(u.x,u.y),b&&r.translate(-1*b.x,-1*b.y),r.fillStyle=r.createPattern(o,C||"repeat"),r.fill()},_fillLinearGradient:function(e){for(var r=this.context,o=e.getFillLinearGradientStartPoint(),i=e.getFillLinearGradientEndPoint(),T=e.getFillLinearGradientColorStops(),u=r.createLinearGradient(o.x,o.y,i.x,i.y),v=0;T.length>v;v+=2)u.addColorStop(T[v],T[v+1]);r.fillStyle=u,r.fill()},_fillRadialGradient:function(e){for(var r=this.context,o=e.getFillRadialGradientStartPoint(),i=e.getFillRadialGradientEndPoint(),T=e.getFillRadialGradientStartRadius(),u=e.getFillRadialGradientEndRadius(),v=e.getFillRadialGradientColorStops(),b=r.createRadialGradient(o.x,o.y,T,i.x,i.y,u),C=0;v.length>C;C+=2)b.addColorStop(v[C],v[C+1]);r.fillStyle=b,r.fill()},_fill:function(e,r){var o=this.context,i=e.getFill(),T=e.getFillPatternImage(),u=e.getFillLinearGradientStartPoint(),v=e.getFillRadialGradientStartPoint(),b=e.getFillPriority();o.save(),!r&&e.hasShadow()&&this._applyShadow(e),i&&"color"===b?this._fillColor(e):T&&"pattern"===b?this._fillPattern(e):u&&"linear-gradient"===b?this._fillLinearGradient(e):v&&"radial-gradient"===b?this._fillRadialGradient(e):i?this._fillColor(e):T?this._fillPattern(e):u?this._fillLinearGradient(e):v&&this._fillRadialGradient(e),o.restore(),!r&&e.hasShadow()&&this._fill(e,!0)},_stroke:function(e,r){var o=this.context,i=e.getStroke(),T=e.getStrokeWidth(),u=e.getDashArray();(i||T)&&(o.save(),this._applyLineCap(e),u&&e.getDashArrayEnabled()&&(o.setLineDash?o.setLineDash(u):"mozDash"in o?o.mozDash=u:"webkitLineDash"in o&&(o.webkitLineDash=u)),!r&&e.hasShadow()&&this._applyShadow(e),o.lineWidth=T||2,o.strokeStyle=i||"black",e._strokeFunc(o),o.restore(),!r&&e.hasShadow()&&this._stroke(e,!0))},_applyShadow:function(e){var r=this.context;if(e.hasShadow()&&e.getShadowEnabled()){var o=e.getAbsoluteOpacity(),i=e.getShadowColor()||"black",T=e.getShadowBlur()||5,u=e.getShadowOffset()||{x:0,y:0};e.getShadowOpacity()&&(r.globalAlpha=e.getShadowOpacity()*o),r.shadowColor=i,r.shadowBlur=T,r.shadowOffsetX=u.x,r.shadowOffsetY=u.y}}},Kinetic.Global.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(e,r,o){Kinetic.Canvas.call(this,e,r,o)},Kinetic.HitCanvas.prototype={_fill:function(e){var r=this.context;r.save(),r.fillStyle="#"+e.colorKey,e._fillFuncHit(r),r.restore()},_stroke:function(e){var r=this.context,o=e.getStroke(),i=e.getStrokeWidth();(o||i)&&(this._applyLineCap(e),r.save(),r.lineWidth=i||2,r.strokeStyle="#"+e.colorKey,e._strokeFuncHit(r),r.restore())}},Kinetic.Global.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){Kinetic.Tween=function(e,r,o,i,T,u){this._listeners=[],this.addListener(this),this.obj=e,this.propFunc=r,this.begin=i,this._pos=i,this.setDuration(u),this.isPlaying=!1,this._change=0,this.prevTime=0,this.prevPos=0,this.looping=!1,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.name="",this.func=o,this.setFinish(T)},Kinetic.Tween.prototype={setTime:function(e){this.prevTime=this._time,e>this.getDuration()?this.looping?(this.rewind(e-this._duration),this.update(),this.broadcastMessage("onLooped",{target:this,type:"onLooped"})):(this._time=this._duration,this.update(),this.stop(),this.broadcastMessage("onFinished",{target:this,type:"onFinished"})):0>e?(this.rewind(),this.update()):(this._time=e,this.update())},getTime:function(){return this._time},setDuration:function(e){this._duration=null===e||0>=e?1e5:e},getDuration:function(){return this._duration},setPosition:function(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e,this.broadcastMessage("onChanged",{target:this,type:"onChanged"})},getPosition:function(e){return void 0===e&&(e=this._time),this.func(e,this.begin,this._change,this._duration)},setFinish:function(e){this._change=e-this.begin},getFinish:function(){return this.begin+this._change},start:function(){this.rewind(),this.startEnterFrame(),this.broadcastMessage("onStarted",{target:this,type:"onStarted"})},rewind:function(e){this.stop(),this._time=void 0===e?0:e,this.fixTime(),this.update()},fforward:function(){this._time=this._duration,this.fixTime(),this.update()},update:function(){this.setPosition(this.getPosition(this._time))},startEnterFrame:function(){this.stopEnterFrame(),this.isPlaying=!0,this.onEnterFrame()},onEnterFrame:function(){this.isPlaying&&this.nextFrame()},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1e3)},stop:function(){this.stopEnterFrame(),this.broadcastMessage("onStopped",{target:this,type:"onStopped"})},stopEnterFrame:function(){this.isPlaying=!1},continueTo:function(e,r){this.begin=this._pos,this.setFinish(e),void 0!==this._duration&&this.setDuration(r),this.start()},resume:function(){this.fixTime(),this.startEnterFrame(),this.broadcastMessage("onResumed",{target:this,type:"onResumed"})},yoyo:function(){this.continueTo(this.begin,this._time)},addListener:function(e){return this.removeListener(e),this._listeners.push(e)},removeListener:function(e){for(var r=this._listeners,o=r.length;o--;)if(r[o]==e)return r.splice(o,1),!0;return!1},broadcastMessage:function(){for(var e=[],r=0;arguments.length>r;r++)e.push(arguments[r]);for(var o=e.shift(),i=this._listeners,T=i.length,r=0;T>r;r++)i[r][o]&&i[r][o].apply(i[r],e)},fixTime:function(){this._startTime=this.getTimer()-1e3*this._time},getTimer:function(){return(new Date).getTime()-this._time}},Kinetic.Tweens={"back-ease-in":function(e,r,o,i){var T=1.70158;return o*(e/=i)*e*((T+1)*e-T)+r},"back-ease-out":function(e,r,o,i){var T=1.70158;return o*((e=e/i-1)*e*((T+1)*e+T)+1)+r},"back-ease-in-out":function(e,r,o,i){var T=1.70158;return 1>(e/=i/2)?o/2*e*e*(((T*=1.525)+1)*e-T)+r:o/2*((e-=2)*e*(((T*=1.525)+1)*e+T)+2)+r},"elastic-ease-in":function(e,r,o,i,T,u){var v=0;return 0===e?r:1==(e/=i)?r+o:(u||(u=.3*i),!T||Math.abs(o)>T?(T=o,v=u/4):v=u/(2*Math.PI)*Math.asin(o/T),-(T*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-v)*Math.PI/u))+r)},"elastic-ease-out":function(e,r,o,i,T,u){var v=0;return 0===e?r:1==(e/=i)?r+o:(u||(u=.3*i),!T||Math.abs(o)>T?(T=o,v=u/4):v=u/(2*Math.PI)*Math.asin(o/T),T*Math.pow(2,-10*e)*Math.sin(2*(e*i-v)*Math.PI/u)+o+r)},"elastic-ease-in-out":function(e,r,o,i,T,u){var v=0;return 0===e?r:2==(e/=i/2)?r+o:(u||(u=1.5*.3*i),!T||Math.abs(o)>T?(T=o,v=u/4):v=u/(2*Math.PI)*Math.asin(o/T),1>e?-.5*T*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-v)*Math.PI/u)+r:.5*T*Math.pow(2,-10*(e-=1))*Math.sin(2*(e*i-v)*Math.PI/u)+o+r)},"bounce-ease-out":function(e,r,o,i){return 1/2.75>(e/=i)?7.5625*o*e*e+r:2/2.75>e?o*(7.5625*(e-=1.5/2.75)*e+.75)+r:2.5/2.75>e?o*(7.5625*(e-=2.25/2.75)*e+.9375)+r:o*(7.5625*(e-=2.625/2.75)*e+.984375)+r},"bounce-ease-in":function(e,r,o,i){return o-Kinetic.Tweens["bounce-ease-out"](i-e,0,o,i)+r},"bounce-ease-in-out":function(e,r,o,i){return i/2>e?.5*Kinetic.Tweens["bounce-ease-in"](2*e,0,o,i)+r:.5*Kinetic.Tweens["bounce-ease-out"](2*e-i,0,o,i)+.5*o+r},"ease-in":function(e,r,o,i){return o*(e/=i)*e+r},"ease-out":function(e,r,o,i){return-o*(e/=i)*(e-2)+r},"ease-in-out":function(e,r,o,i){return 1>(e/=i/2)?o/2*e*e+r:-o/2*(--e*(e-2)-1)+r},"strong-ease-in":function(e,r,o,i){return o*(e/=i)*e*e*e*e+r},"strong-ease-out":function(e,r,o,i){return o*((e=e/i-1)*e*e*e*e+1)+r},"strong-ease-in-out":function(e,r,o,i){return 1>(e/=i/2)?o/2*e*e*e*e*e+r:o/2*((e-=2)*e*e*e*e+2)+r},linear:function(e,r,o,i){return o*e/i+r}}}(),function(){Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(e,r){this.m[4]+=this.m[0]*e+this.m[2]*r,this.m[5]+=this.m[1]*e+this.m[3]*r},scale:function(e,r){this.m[0]*=e,this.m[1]*=e,this.m[2]*=r,this.m[3]*=r},rotate:function(e){var r=Math.cos(e),o=Math.sin(e),i=this.m[0]*r+this.m[2]*o,T=this.m[1]*r+this.m[3]*o,u=this.m[0]*-o+this.m[2]*r,v=this.m[1]*-o+this.m[3]*r;this.m[0]=i,this.m[1]=T,this.m[2]=u,this.m[3]=v},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},multiply:function(e){var r=this.m[0]*e.m[0]+this.m[2]*e.m[1],o=this.m[1]*e.m[0]+this.m[3]*e.m[1],i=this.m[0]*e.m[2]+this.m[2]*e.m[3],T=this.m[1]*e.m[2]+this.m[3]*e.m[3],u=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],v=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=r,this.m[1]=o,this.m[2]=i,this.m[3]=T,this.m[4]=u,this.m[5]=v},invert:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),r=this.m[3]*e,o=-this.m[1]*e,i=-this.m[2]*e,T=this.m[0]*e,u=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),v=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=r,this.m[1]=o,this.m[2]=i,this.m[3]=T,this.m[4]=u,this.m[5]=v},getMatrix:function(){return this.m}}}(),function(){Kinetic.Collection=function(){var e=[].slice.call(arguments),r=e.length,o=0;this.length=r;for(;r>o;o++)this[o]=e[o];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.apply=function(e){args=[].slice.call(arguments),args.shift();for(var r=0;this.length>r;r++)Kinetic.Type._isFunction(this[r][e])&&this[r][e].apply(this[r],args)},Kinetic.Collection.prototype.each=function(e){for(var r=0;this.length>r;r++)e.call(this[r],r,this[r])}}(),function(){Kinetic.Filters.Grayscale=function(e){for(var r=e.data,o=0;r.length>o;o+=4){var i=.34*r[o]+.5*r[o+1]+.16*r[o+2];r[o]=i,r[o+1]=i,r[o+2]=i}}}(),function(){Kinetic.Filters.Brighten=function(e,r){for(var o=r.val||0,i=e.data,T=0;i.length>T;T+=4)i[T]+=o,i[T+1]+=o,i[T+2]+=o}}(),function(){Kinetic.Filters.Invert=function(e){for(var r=e.data,o=0;r.length>o;o+=4)r[o]=255-r[o],r[o+1]=255-r[o+1],r[o+2]=255-r[o+2]}}(),function(){Kinetic.Node=function(e){this._nodeInit(e)},Kinetic.Node.prototype={_nodeInit:function(e){this._id=Kinetic.Global.idCounter++,this.defaultNodeAttrs={visible:!0,listening:!0,name:void 0,opacity:1,x:0,y:0,scale:{x:1,y:1},rotation:0,offset:{x:0,y:0},draggable:!1,dragOnTop:!0},this.setDefaultAttrs(this.defaultNodeAttrs),this.eventListeners={},this.setAttrs(e)},on:function(e,r){for(var o=e.split(" "),i=o.length,T=0;i>T;T++){var u=o[T],v=u,b=v.split("."),C=b[0],z=b.length>1?b[1]:"";this.eventListeners[C]||(this.eventListeners[C]=[]),this.eventListeners[C].push({name:z,handler:r})}},off:function(e){for(var r=e.split(" "),o=r.length,i=0;o>i;i++){var T=r[i],u=T,v=u.split("."),b=v[0];if(v.length>1)if(b)this.eventListeners[b]&&this._off(b,v[1]);else for(var T in this.eventListeners)this._off(T,v[1]);else delete this.eventListeners[b]}},remove:function(){var e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices()),delete this.parent},destroy:function(){for(var e=(this.getParent(),this.getStage(),Kinetic.DD),r=Kinetic.Global;this.children&&this.children.length>0;)this.children[0].destroy();r._removeId(this.getId()),r._removeName(this.getName(),this._id),e&&e.node&&e.node._id===this._id&&node._endDrag(),this.trans&&this.trans.stop(),this.remove()},getAttrs:function(){return this.attrs},setDefaultAttrs:function(e){void 0===this.attrs&&(this.attrs={});if(e)for(var r in e)void 0===this.attrs[r]&&(this.attrs[r]=e[r])},setAttrs:function(e){if(e)for(var r in e){var o="set"+r.charAt(0).toUpperCase()+r.slice(1);Kinetic.Type._isFunction(this[o])?this[o](e[r]):this.setAttr(r,e[r])}},getVisible:function(){var e=this.attrs.visible,r=this.getParent();return e&&r&&!r.getVisible()?!1:e},getListening:function(){var e=this.attrs.listening,r=this.getParent();return e&&r&&!r.getListening()?!1:e},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},getZIndex:function(){return this.index},getAbsoluteZIndex:function(){function e(T){for(var u=[],v=T.length,b=0;v>b;b++){var C=T[b];i++,"Shape"!==C.nodeType&&(u=u.concat(C.getChildren())),C._id===o._id&&(b=v)}u.length>0&&r>=u[0].getLevel()&&e(u)}var r=this.getLevel(),o=(this.getStage(),this),i=0;return"Stage"!==o.nodeType&&e(o.getStage().getChildren()),i},getLevel:function(){for(var e=0,r=this.parent;r;)e++,r=r.parent;return e},setPosition:function(){var e=Kinetic.Type._getXY([].slice.call(arguments));this.setAttr("x",e.x),this.setAttr("y",e.y)},getPosition:function(){var e=this.attrs;return{x:e.x,y:e.y}},getAbsolutePosition:function(){var e=this.getAbsoluteTransform(),r=this.getOffset();return e.translate(r.x,r.y),e.getTranslation()},setAbsolutePosition:function(){var e=Kinetic.Type._getXY([].slice.call(arguments)),r=this._clearTransform();this.attrs.x=r.x,this.attrs.y=r.y,delete r.x,delete r.y;var o=this.getAbsoluteTransform();o.invert(),o.translate(e.x,e.y),e={x:this.attrs.x+o.getTranslation().x,y:this.attrs.y+o.getTranslation().y},this.setPosition(e.x,e.y),this._setTransform(r)},move:function(){var e=Kinetic.Type._getXY([].slice.call(arguments)),r=this.getX(),o=this.getY();void 0!==e.x&&(r+=e.x),void 0!==e.y&&(o+=e.y),this.setPosition(r,o)},_eachAncestorReverse:function(e,r){var o=[],i=this.getParent();r&&o.unshift(this);for(;i;)o.unshift(i),i=i.parent;for(var T=o.length,u=0;T>u;u++)e(o[u])},rotate:function(e){this.setRotation(this.getRotation()+e)},rotateDeg:function(e){this.setRotation(this.getRotation()+Kinetic.Type._degToRad(e))},moveToTop:function(){var e=this.index;return this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var e=this.index,r=this.parent.getChildren().length;return r-1>e?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):void 0},moveDown:function(){var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):void 0},moveToBottom:function(){var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):void 0},setZIndex:function(e){var r=this.index;this.parent.children.splice(r,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices()},getAbsoluteOpacity:function(){var e=this.getOpacity();return this.getParent()&&(e*=this.getParent().getAbsoluteOpacity()),e},moveTo:function(e){Kinetic.Node.prototype.remove.call(this),e.add(this)},toObject:function(){var e=Kinetic.Type,r={},o=this.attrs;r.attrs={};for(var i in o){var T=o[i];!(e._isFunction(T)||e._isElement(T)||e._isObject(T)&&e._hasMethods(T)||!(r.attrs[i]=T))}return r.nodeType=this.nodeType,r.shapeType=this.shapeType,r},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this.getParent()?this.getParent().getStage():void 0},simulate:function(e,r){this._handleEvent(e,r||{})},fire:function(e,r){this._executeHandlers(e,r||{})},getAbsoluteTransform:function(){var e=new Kinetic.Transform;return this._eachAncestorReverse(function(r){var o=r.getTransform();e.multiply(o)},!0),e},getTransform:function(){var e=new Kinetic.Transform,r=this.attrs,o=r.x,i=r.y,T=r.rotation,u=r.scale,v=u.x,b=u.y,C=r.offset,z=C.x,n=C.y;return(0!==o||0!==i)&&e.translate(o,i),0!==T&&e.rotate(T),(1!==v||1!==b)&&e.scale(v,b),(0!==z||0!==n)&&e.translate(-1*z,-1*n),e},clone:function(e){var r=this.shapeType||this.nodeType,o=new Kinetic[r](this.attrs);for(var i in this.eventListeners)for(var T=this.eventListeners[i],u=T.length,v=0;u>v;v++){var b=T[v];0>b.name.indexOf("kinetic")&&(o.eventListeners[i]||(o.eventListeners[i]=[]),o.eventListeners[i].push(b))}return o.setAttrs(e),o},toDataURL:function(e){e=e||{};var r,o,i=e.mimeType||null,T=e.quality||null,u=e.x||0,v=e.y||0;return e.width&&e.height?r=new Kinetic.SceneCanvas(e.width,e.height,1):(r=this.getStage().bufferCanvas,r.clear()),o=r.getContext(),o.save(),(u||v)&&o.translate(-1*u,-1*v),this.drawScene(r),o.restore(),r.toDataURL(i,T)},toImage:function(e){Kinetic.Type._getImage(this.toDataURL(e),function(r){e.callback(r)})},setSize:function(){var e=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setWidth(e.width),this.setHeight(e.height)},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},_get:function(e){return this.nodeType===e?[this]:[]},_off:function(e,r){for(var o=0;this.eventListeners[e].length>o;o++)if(this.eventListeners[e][o].name===r){this.eventListeners[e].splice(o,1);if(0===this.eventListeners[e].length){delete this.eventListeners[e];break}o--}},_clearTransform:function(){var e=this.attrs,r=e.scale,o=e.offset,i={x:e.x,y:e.y,rotation:e.rotation,scale:{x:r.x,y:r.y},offset:{x:o.x,y:o.y}};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scale={x:1,y:1},this.attrs.offset={x:0,y:0},i},_setTransform:function(e){for(var r in e)this.attrs[r]=e[r]},_fireBeforeChangeEvent:function(e,r,o){this._handleEvent("before"+e.toUpperCase()+"Change",{oldVal:r,newVal:o})},_fireChangeEvent:function(e,r,o){this._handleEvent(e+"Change",{oldVal:r,newVal:o})},setId:function(e){var r=this.getId(),o=(this.getStage(),Kinetic.Global);o._removeId(r),o._addId(this,e),this.setAttr("id",e)},setName:function(e){var r=this.getName(),o=(this.getStage(),Kinetic.Global);o._removeName(r,this._id),o._addName(this,e),this.setAttr("name",e)},setAttr:function(e,r){if(void 0!==r){var o=this.attrs[e];this._fireBeforeChangeEvent(e,o,r),this.attrs[e]=r,this._fireChangeEvent(e,o,r)}},_handleEvent:function(e,r,o){r&&"Shape"===this.nodeType&&(r.shape=this);var i=(this.getStage(),this.eventListeners),T=!0;"mouseenter"===e&&o&&this._id===o._id?T=!1:"mouseleave"===e&&o&&this._id===o._id&&(T=!1),T&&(i[e]&&this.fire(e,r),r&&!r.cancelBubble&&this.parent&&(o&&o.parent?this._handleEvent.call(this.parent,e,r,o.parent):this._handleEvent.call(this.parent,e,r)))},_executeHandlers:function(e,r){for(var o=this.eventListeners[e],i=o.length,T=0;i>T;T++)o[T].handler.apply(this,[r])}},Kinetic.Node.addSetters=function(e,r){for(var o=r.length,i=0;o>i;i++){var T=r[i];this._addSetter(e,T)}},Kinetic.Node.addPointSetters=function(e,r){for(var o=r.length,i=0;o>i;i++){var T=r[i];this._addPointSetter(e,T)}},Kinetic.Node.addRotationSetters=function(e,r){for(var o=r.length,i=0;o>i;i++){var T=r[i];this._addRotationSetter(e,T)}},Kinetic.Node.addGetters=function(e,r){for(var o=r.length,i=0;o>i;i++){var T=r[i];this._addGetter(e,T)}},Kinetic.Node.addRotationGetters=function(e,r){for(var o=r.length,i=0;o>i;i++){var T=r[i];this._addRotationGetter(e,T)}},Kinetic.Node.addGettersSetters=function(e,r){this.addSetters(e,r),this.addGetters(e,r)},Kinetic.Node.addPointGettersSetters=function(e,r){this.addPointSetters(e,r),this.addGetters(e,r)},Kinetic.Node.addRotationGettersSetters=function(e,r){this.addRotationSetters(e,r),this.addRotationGetters(e,r)},Kinetic.Node._addSetter=function(e,r){var o="set"+r.charAt(0).toUpperCase()+r.slice(1);e.prototype[o]=function(e){this.setAttr(r,e)}},Kinetic.Node._addPointSetter=function(e,r){var o="set"+r.charAt(0).toUpperCase()+r.slice(1);e.prototype[o]=function(){var e=Kinetic.Type._getXY([].slice.call(arguments));e&&void 0===e.x&&(e.x=this.attrs[r].x),e&&void 0===e.y&&(e.y=this.attrs[r].y),this.setAttr(r,e)}},Kinetic.Node._addRotationSetter=function(e,r){var o="set"+r.charAt(0).toUpperCase()+r.slice(1);e.prototype[o]=function(e){this.setAttr(r,e)},e.prototype[o+"Deg"]=function(e){this.setAttr(r,Kinetic.Type._degToRad(e))}},Kinetic.Node._addGetter=function(e,r){var o="get"+r.charAt(0).toUpperCase()+r.slice(1);e.prototype[o]=function(){return this.attrs[r]}},Kinetic.Node._addRotationGetter=function(e,r){var o="get"+r.charAt(0).toUpperCase()+r.slice(1);e.prototype[o]=function(){return this.attrs[r]},e.prototype[o+"Deg"]=function(){return Kinetic.Type._radToDeg(this.attrs[r])}},Kinetic.Node.create=function(e,r){return this._createNode(JSON.parse(e),r)},Kinetic.Node._createNode=function(e,r){var o;o="Shape"===e.nodeType?void 0===e.shapeType?"Shape":e.shapeType:e.nodeType,r&&(e.attrs.container=r);var i=new Kinetic[o](e.attrs);if(e.children)for(var T=e.children.length,u=0;T>u;u++)i.add(this._createNode(e.children[u]));return i},Kinetic.Node.addGettersSetters(Kinetic.Node,["x","y","opacity"]),Kinetic.Node.addGetters(Kinetic.Node,["name","id"]),Kinetic.Node.addRotationGettersSetters(Kinetic.Node,["rotation"]),Kinetic.Node.addPointGettersSetters(Kinetic.Node,["scale","offset"]),Kinetic.Node.addSetters(Kinetic.Node,["width","height","listening","visible"]),Kinetic.Node.prototype.isListening=Kinetic.Node.prototype.getListening,Kinetic.Node.prototype.isVisible=Kinetic.Node.prototype.getVisible;for(var e=["on","off"],r=0;2>r;r++)(function(r){var o=e[r];Kinetic.Collection.prototype[o]=function(){var e=[].slice.call(arguments);e.unshift(o),this.apply.apply(this,e)}})(r)}(),function(){Kinetic.Animation=function(e,r){this.func=e,this.node=r,this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={isRunning:function(){for(var e=Kinetic.Animation,r=e.animations,o=0;r.length>o;o++)if(r[o].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation.fixedRequestAnimFrame=function(e){window.setTimeout(e,1e3/60)},Kinetic.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(e){for(var r=e.id,o=this.animations,i=o.length,T=0;i>T;T++)if(o[T].id===r){this.animations.splice(T,1);break}},Kinetic.Animation._runFrames=function(){for(var e={},r=this.animations,o=0;r.length>o;o++){var i=r[o],T=i.node,u=i.func;i._updateFrameObject((new Date).getTime()),T&&void 0!==T._id&&(e[T._id]=T),u&&u(i.frame)}for(var v in e)e[v].draw()},Kinetic.Animation._animationLoop=function(){var e=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){e._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var e=this;this.animRunning||(this.animRunning=!0,e._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||Kinetic.Animation.fixedRequestAnimFrame}(),Kinetic.Animation.requestAnimFrame=function(e){var r=Kinetic.DD&&Kinetic.DD.moving?this.fixedRequestAnimFrame:RAF;r(e)};var e=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(r){e.call(this,r)}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,moving:!1,offset:{x:0,y:0}},Kinetic.getNodeDragging=function(){return Kinetic.DD.node},Kinetic.DD._setupDragLayerAndGetContainer=function(e){var r,o,i=e.getStage();e.nodeType;return e._eachAncestorReverse(function(e){"Layer"===e.nodeType?(i.dragLayer.setAttrs(e.getAttrs()),r=i.dragLayer,i.add(i.dragLayer)):"Group"===e.nodeType&&(o=new Kinetic.Group(e.getAttrs()),r.add(o),r=o)}),r},Kinetic.DD._initDragLayer=function(e){e.dragLayer=new Kinetic.Layer,e.dragLayer.getCanvas().getElement().className="kinetic-drag-and-drop-layer"},Kinetic.DD._drag=function(e){var r=Kinetic.DD,o=r.node;if(o){var i=o.getStage().getUserPosition(),T=o.attrs.dragBoundFunc,u={x:i.x-r.offset.x,y:i.y-r.offset.y};void 0!==T&&(u=T.call(o,u,e)),o.setAbsolutePosition(u),r.moving||(r.moving=!0,o.setListening(!1),o._handleEvent("dragstart",e)),o._handleEvent("dragmove",e)}},Kinetic.DD._endDrag=function(e){var r=Kinetic.DD,o=r.node;if(o){var i=o.nodeType;o.getStage();o.setListening(!0),"Stage"===i?o.draw():(("Group"===i||"Shape"===i)&&o.getDragOnTop()&&r.prevParent&&(o.moveTo(r.prevParent),o.getStage().dragLayer.remove(),r.prevParent=null),o.getLayer().draw()),delete r.node,r.anim.stop(),r.moving&&(r.moving=!1,o._handleEvent("dragend",e))}},Kinetic.Node.prototype._startDrag=function(){var e=Kinetic.DD,r=this,o=this.getStage(),i=o.getUserPosition();if(i){var T,u=(this.getTransform().getTranslation(),this.getAbsolutePosition()),v=this.nodeType;e.node=this,e.offset.x=i.x-u.x,e.offset.y=i.y-u.y,"Stage"===v||"Layer"===v?(e.anim.node=this,e.anim.start()):this.getDragOnTop()?(T=e._setupDragLayerAndGetContainer(this),e.anim.node=o.dragLayer,e.prevParent=this.getParent(),setTimeout(function(){e.node&&(r.moveTo(T),e.prevParent.getLayer().draw(),o.dragLayer.draw(),e.anim.start())},0)):(e.anim.node=this.getLayer(),e.anim.start())}},Kinetic.Node.prototype.setDraggable=function(e){this.setAttr("draggable",e),this._dragChange()},Kinetic.Node.prototype.getDraggable=function(){return this.attrs.draggable},Kinetic.Node.prototype.isDragging=function(){var e=Kinetic.DD;return e.node&&e.node._id===this._id&&e.moving},Kinetic.Node.prototype._listenDrag=function(){this._dragCleanup();var e=this;this.on("mousedown.kinetic touchstart.kinetic",function(r){Kinetic.getNodeDragging()||e._startDrag(r)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage(),r=Kinetic.DD;e&&r.node&&r.node._id===this._id&&r._endDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable,Kinetic.Node.addGettersSetters(Kinetic.Node,["dragBoundFunc","dragOnTop"]);var e=document.getElementsByTagName("html")[0];e.addEventListener("mouseup",Kinetic.DD._endDrag,!0),e.addEventListener("touchend",Kinetic.DD._endDrag,!0)}(),function(){Kinetic.Transition=function(e,r){function o(e,r,T,u){for(var v in e)"duration"!==v&&"easing"!==v&&"callback"!==v&&(Kinetic.Type._isObject(e[v])?(T[v]={},o(e[v],r[v],T[v],u)):i._add(i._getTween(r,v,e[v],T,u)))}var i=this,T={};this.node=e,this.config=r,this.tweens=[],o(r,e.attrs,T,T),this.tweens[0].onStarted=function(){},this.tweens[0].onStopped=function(){e.transAnim.stop()
},this.tweens[0].onResumed=function(){e.transAnim.start()},this.tweens[0].onLooped=function(){},this.tweens[0].onChanged=function(){},this.tweens[0].onFinished=function(){var o={};for(var i in r)"duration"!==i&&"easing"!==i&&"callback"!==i&&(o[i]=r[i]);e.transAnim.stop(),e.setAttrs(o),r.callback&&r.callback()}},Kinetic.Transition.prototype={start:function(){for(var e=0;this.tweens.length>e;e++)this.tweens[e].start()},stop:function(){for(var e=0;this.tweens.length>e;e++)this.tweens[e].stop()},resume:function(){for(var e=0;this.tweens.length>e;e++)this.tweens[e].resume()},_onEnterFrame:function(){for(var e=0;this.tweens.length>e;e++)this.tweens[e].onEnterFrame()},_add:function(e){this.tweens.push(e)},_getTween:function(e,r,o,i,T){var u=this.config,v=this.node,b=u.easing;void 0===b&&(b="linear");var C=new Kinetic.Tween(v,function(e){i[r]=e,v.setAttrs(T)},Kinetic.Tweens[b],e[r],o,u.duration);return C}},Kinetic.Node.prototype.transitionTo=function(e){var r=new Kinetic.Transition(this,e);return this.transAnim||(this.transAnim=new Kinetic.Animation),this.transAnim.func=function(){r._onEnterFrame()},this.transAnim.node="Stage"===this.nodeType?this:this.getLayer(),r.start(),this.transAnim.start(),this.trans=r,r}}(),function(){Kinetic.Container=function(e){this._containerInit(e)},Kinetic.Container.prototype={_containerInit:function(e){this.children=[],Kinetic.Node.call(this,e)},getChildren:function(){return this.children},removeChildren:function(){for(;this.children.length>0;)this.children[0].remove()},add:function(e){var r=(Kinetic.Global,this.children);return e.index=r.length,e.parent=this,r.push(e),this},get:function(e){var r=new Kinetic.Collection;if("#"===e.charAt(0)){var o=this._getNodeById(e.slice(1));o&&r.push(o)}else if("."===e.charAt(0)){var i=this._getNodesByName(e.slice(1));Kinetic.Collection.apply(r,i)}else{for(var T=[],u=this.getChildren(),v=u.length,b=0;v>b;b++)T=T.concat(u[b]._get(e));Kinetic.Collection.apply(r,T)}return r},_getNodeById:function(e){var r=(this.getStage(),Kinetic.Global),o=r.ids[e];return void 0!==o&&this.isAncestorOf(o)?o:null},_getNodesByName:function(e){var r=Kinetic.Global,o=r.names[e]||[];return this._getDescendants(o)},_get:function(e){for(var r=Kinetic.Node.prototype._get.call(this,e),o=this.getChildren(),i=o.length,T=0;i>T;T++)r=r.concat(o[T]._get(e));return r},toObject:function(){var e=Kinetic.Node.prototype.toObject.call(this);e.children=[];for(var r=this.getChildren(),o=r.length,i=0;o>i;i++){var T=r[i];e.children.push(T.toObject())}return e},_getDescendants:function(e){for(var r=[],o=e.length,i=0;o>i;i++){var T=e[i];this.isAncestorOf(T)&&r.push(T)}return r},isAncestorOf:function(e){for(var r=e.getParent();r;){if(r._id===this._id)return!0;r=r.getParent()}return!1},clone:function(e){var r=Kinetic.Node.prototype.clone.call(this,e);for(var o in this.children)r.add(this.children[o].clone());return r},getIntersections:function(){for(var e=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),r=[],o=this.get("Shape"),i=o.length,T=0;i>T;T++){var u=o[T];u.isVisible()&&u.intersects(e)&&r.push(u)}return r},_setChildrenIndices:function(){for(var e=this.children,r=e.length,o=0;r>o;o++)e[o].index=o},draw:function(){this.drawScene(),this.drawHit()},drawScene:function(e){if(this.isVisible())for(var r=this.children,o=r.length,i=0;o>i;i++)r[i].drawScene(e)},drawHit:function(){if(this.isVisible()&&this.isListening())for(var e=this.children,r=e.length,o=0;r>o;o++)e[o].drawHit()}},Kinetic.Global.extend(Kinetic.Container,Kinetic.Node)}(),function(){function e(e){e.fill()}function r(e){e.stroke()}function o(e){e.fill()}function i(e){e.stroke()}Kinetic.Shape=function(e){this._initShape(e)},Kinetic.Shape.prototype={_initShape:function(T){this.setDefaultAttrs({fillEnabled:!0,strokeEnabled:!0,shadowEnabled:!0,dashArrayEnabled:!0,fillPriority:"color"}),this.nodeType="Shape",this._fillFunc=e,this._strokeFunc=r,this._fillFuncHit=o,this._strokeFuncHit=i;for(var u,v=Kinetic.Global.shapes;;){u=Kinetic.Type._getRandomColorKey();if(u&&!(u in v))break}this.colorKey=u,v[u]=this,Kinetic.Node.call(this,T)},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffset())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientStartPoint()||this.getFillRadialGradientStartPoint())},_get:function(e){return this.nodeType===e||this.shapeType===e?[this]:[]},intersects:function(){var e=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),r=this.getStage(),o=r.hitCanvas;o.clear(),this.drawScene(o);var i=o.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data;return i[3]>0},enableFill:function(){this.setAttr("fillEnabled",!0)},disableFill:function(){this.setAttr("fillEnabled",!1)},enableStroke:function(){this.setAttr("strokeEnabled",!0)},disableStroke:function(){this.setAttr("strokeEnabled",!1)},enableShadow:function(){this.setAttr("shadowEnabled",!0)},disableShadow:function(){this.setAttr("shadowEnabled",!1)},enableDashArray:function(){this.setAttr("dashArrayEnabled",!0)},disableDashArray:function(){this.setAttr("dashArrayEnabled",!1)},remove:function(){Kinetic.Node.prototype.remove.call(this),delete Kinetic.Global.shapes[this.colorKey]},drawScene:function(e){var r=this.attrs,o=r.drawFunc,e=e||this.getLayer().getCanvas(),i=e.getContext();o&&this.isVisible()&&(i.save(),e._applyOpacity(this),e._applyLineJoin(this),e._applyAncestorTransforms(this),o.call(this,e),i.restore())},drawHit:function(){var e=this.attrs,r=e.drawHitFunc||e.drawFunc,o=this.getLayer().hitCanvas,i=o.getContext();r&&this.isVisible()&&this.isListening()&&(i.save(),o._applyLineJoin(this),o._applyAncestorTransforms(this),r.call(this,o),i.restore())},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}},Kinetic.Global.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Node.addGettersSetters(Kinetic.Shape,["stroke","lineJoin","lineCap","strokeWidth","drawFunc","drawHitFunc","dashArray","shadowColor","shadowBlur","shadowOpacity","fillPatternImage","fill","fillPatternX","fillPatternY","fillLinearGradientColorStops","fillRadialGradientStartRadius","fillRadialGradientEndRadius","fillRadialGradientColorStops","fillPatternRepeat","fillEnabled","strokeEnabled","shadowEnabled","dashArrayEnabled","fillPriority"]),Kinetic.Node.addPointGettersSetters(Kinetic.Shape,["fillPatternOffset","fillPatternScale","fillLinearGradientStartPoint","fillLinearGradientEndPoint","fillRadialGradientStartPoint","fillRadialGradientEndPoint","shadowOffset"]),Kinetic.Node.addRotationGettersSetters(Kinetic.Shape,["fillPatternRotation"])}(),function(){Kinetic.Stage=function(e){this._initStage(e)},Kinetic.Stage.prototype={_initStage:function(e){var r=Kinetic.DD;this.setDefaultAttrs({width:400,height:200}),Kinetic.Container.call(this,e),this._setStageDefaultProperties(),this._id=Kinetic.Global.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.Global.stages.push(this),r&&r._initDragLayer(this)},setContainer:function(e){"string"==typeof e&&(e=document.getElementById(e)),this.setAttr("container",e)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this._resizeDOM()},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this._resizeDOM()},clear:function(){for(var e=this.children,r=0;e.length>r;r++)e[r].clear()},remove:function(){var e=this.content;Kinetic.Node.prototype.remove.call(this),e&&Kinetic.Type._isInDocument(e)&&this.attrs.container.removeChild(e)},reset:function(){this.removeChildren(),this._setStageDefaultProperties(),this.setAttrs(this.defaultNodeAttrs)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getUserPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(e){function r(T){var u=C[T],z=u.toDataURL(),n=new Image;n.onload=function(){b.drawImage(n,0,0),C.length-1>T?r(T+1):e.callback(v.toDataURL(o,i))},n.src=z}e=e||{};var o=e.mimeType||null,i=e.quality||null,T=e.x||0,u=e.y||0,v=new Kinetic.SceneCanvas(e.width||this.getWidth(),e.height||this.getHeight()),b=v.getContext(),C=this.children;(T||u)&&b.translate(-1*T,-1*u),r(0)},toImage:function(e){var r=e.callback;e.callback=function(e){Kinetic.Type._getImage(e,function(e){r(e)})},this.toDataURL(e)},getIntersection:function(e){for(var r,o=this.getChildren(),i=o.length-1;i>=0;i--){var T=o[i];if(T.isVisible()&&T.isListening()){var u=T.hitCanvas.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data;if(255===u[3]){var v=Kinetic.Type._rgbToHex(u[0],u[1],u[2]);return r=Kinetic.Global.shapes[v],{shape:r,pixel:u}}if(u[0]>0||u[1]>0||u[2]>0||u[3]>0)return{pixel:u}}}return null},_resizeDOM:function(){if(this.content){var e=this.attrs.width,r=this.attrs.height;this.content.style.width=e+"px",this.content.style.height=r+"px",this.bufferCanvas.setSize(e,r,1),this.hitCanvas.setSize(e,r);for(var o=this.children,i=0;o.length>i;i++){var T=o[i];T.getCanvas().setSize(e,r),T.hitCanvas.setSize(e,r),T.draw()}}},add:function(e){return Kinetic.Container.prototype.add.call(this,e),e.canvas.setSize(this.attrs.width,this.attrs.height),e.hitCanvas.setSize(this.attrs.width,this.attrs.height),e.draw(),this.content.appendChild(e.canvas.element),this},getDragLayer:function(){return this.dragLayer},_setUserPosition:function(e){e||(e=window.event),this._setMousePosition(e),this._setTouchPosition(e)},_bindContentEvents:function(){for(var e=(Kinetic.Global,this),r=["mousedown","mousemove","mouseup","mouseout","touchstart","touchmove","touchend"],o=0;r.length>o;o++){var i=r[o];(function(){var r=i;e.content.addEventListener(r,function(o){e["_"+r](o)},!1)})()}},_mouseout:function(e){this._setUserPosition(e);var r=Kinetic.DD,o=this.targetShape;o&&(!r||!r.moving)&&(o._handleEvent("mouseout",e),o._handleEvent("mouseleave",e),this.targetShape=null),this.mousePos=void 0},_mousemove:function(e){this._setUserPosition(e);var r=Kinetic.DD,o=this.getIntersection(this.getUserPosition());if(o){var i=o.shape;i&&(r&&r.moving||255!==o.pixel[3]||this.targetShape&&this.targetShape._id===i._id?i._handleEvent("mousemove",e):(this.targetShape&&(this.targetShape._handleEvent("mouseout",e,i),this.targetShape._handleEvent("mouseleave",e,i)),i._handleEvent("mouseover",e,this.targetShape),i._handleEvent("mouseenter",e,this.targetShape),this.targetShape=i))}else this.targetShape&&(!r||!r.moving)&&(this.targetShape._handleEvent("mouseout",e),this.targetShape._handleEvent("mouseleave",e),this.targetShape=null);r&&r._drag(e)},_mousedown:function(e){var r,o=Kinetic.DD;this._setUserPosition(e),r=this.getIntersection(this.getUserPosition());if(r&&r.shape){var i=r.shape;this.clickStart=!0,i._handleEvent("mousedown",e)}o&&this.attrs.draggable&&!o.node&&this._startDrag(e)},_mouseup:function(e){this._setUserPosition(e);var r=this,o=Kinetic.DD,i=this.getIntersection(this.getUserPosition());if(i&&i.shape){var T=i.shape;T._handleEvent("mouseup",e),this.clickStart&&(!o||!o.moving||!o.node)&&(T._handleEvent("click",e),this.inDoubleClickWindow&&T._handleEvent("dblclick",e),this.inDoubleClickWindow=!0,setTimeout(function(){r.inDoubleClickWindow=!1},this.dblClickWindow))}this.clickStart=!1},_touchstart:function(e){var r,o=Kinetic.DD;this._setUserPosition(e),e.preventDefault(),r=this.getIntersection(this.getUserPosition());if(r&&r.shape){var i=r.shape;this.tapStart=!0,i._handleEvent("touchstart",e)}o&&this.attrs.draggable&&!o.node&&this._startDrag(e)},_touchend:function(e){this._setUserPosition(e);var r=this,o=Kinetic.DD,i=this.getIntersection(this.getUserPosition());if(i&&i.shape){var T=i.shape;T._handleEvent("touchend",e),this.tapStart&&(!o||!o.moving||!o.node)&&(T._handleEvent("tap",e),this.inDoubleClickWindow&&T._handleEvent("dbltap",e),this.inDoubleClickWindow=!0,setTimeout(function(){r.inDoubleClickWindow=!1},this.dblClickWindow))}this.tapStart=!1},_touchmove:function(e){this._setUserPosition(e);var r=Kinetic.DD;e.preventDefault();var o=this.getIntersection(this.getUserPosition());if(o&&o.shape){var i=o.shape;i._handleEvent("touchmove",e)}r&&r._drag(e)},_setMousePosition:function(e){var r=e.clientX-this._getContentPosition().left,o=e.clientY-this._getContentPosition().top;this.mousePos={x:r,y:o}},_setTouchPosition:function(e){if(void 0!==e.touches&&1===e.touches.length){var r=e.touches[0],o=r.clientX-this._getContentPosition().left,i=r.clientY-this._getContentPosition().top;this.touchPos={x:o,y:i}}},_getContentPosition:function(){var e=this.content.getBoundingClientRect();return{top:e.top,left:e.left}},_buildDOM:function(){this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.display="inline-block",this.content.className="kineticjs-content",this.attrs.container.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(e,r){for(var o=e.split(" "),i=0;o.length>i;i++){var T=o[i];this.content.addEventListener(T,r,!1)}},_setStageDefaultProperties:function(){this.nodeType="Stage",this.dblClickWindow=400,this.targetShape=null,this.mousePos=void 0,this.clickStart=!1,this.touchPos=void 0,this.tapStart=!1}},Kinetic.Global.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Node.addGetters(Kinetic.Stage,["container"])}(),function(){Kinetic.Layer=function(e){this._initLayer(e)},Kinetic.Layer.prototype={_initLayer:function(e){this.setDefaultAttrs({clearBeforeDraw:!0}),this.nodeType="Layer",this.beforeDrawFunc=void 0,this.afterDrawFunc=void 0,this.canvas=new Kinetic.SceneCanvas,this.canvas.getElement().style.position="absolute",this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,e)},draw:function(){this.getContext();void 0!==this.beforeDrawFunc&&this.beforeDrawFunc.call(this),Kinetic.Container.prototype.draw.call(this),void 0!==this.afterDrawFunc&&this.afterDrawFunc.call(this)},drawHit:function(){this.hitCanvas.clear(),Kinetic.Container.prototype.drawHit.call(this)},drawScene:function(e){e=e||this.getCanvas(),this.attrs.clearBeforeDraw&&e.clear(),Kinetic.Container.prototype.drawScene.call(this,e)},toDataURL:function(e){e=e||{};var r=e.mimeType||null,o=e.quality||null;e.x||0,e.y||0;return e.width||e.height||e.x||e.y?Kinetic.Node.prototype.toDataURL.call(this,e):this.getCanvas().toDataURL(r,o)},beforeDraw:function(e){this.beforeDrawFunc=e},afterDraw:function(e){this.afterDrawFunc=e},getCanvas:function(){return this.canvas},getContext:function(){return this.canvas.context},clear:function(){this.getCanvas().clear()},setVisible:function(e){Kinetic.Node.prototype.setVisible.call(this,e),e?(this.canvas.element.style.display="block",this.hitCanvas.element.style.display="block"):(this.canvas.element.style.display="none",this.hitCanvas.element.style.display="none")},setZIndex:function(e){Kinetic.Node.prototype.setZIndex.call(this,e);var r=this.getStage();r&&(r.content.removeChild(this.canvas.element),r.getChildren().length-1>e?r.content.insertBefore(this.canvas.element,r.getChildren()[e+1].canvas.element):r.content.appendChild(this.canvas.element))},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var e=this.getStage();e&&(e.content.removeChild(this.canvas.element),e.content.appendChild(this.canvas.element))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var e=this.getStage();e&&(e.content.removeChild(this.canvas.element),this.index<e.getChildren().length-1?e.content.insertBefore(this.canvas.element,e.getChildren()[this.index+1].canvas.element):e.content.appendChild(this.canvas.element))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var e=this.getStage();if(e){var r=e.getChildren();e.content.removeChild(this.canvas.element),e.content.insertBefore(this.canvas.element,r[this.index+1].canvas.element)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var r=e.getChildren();e.content.removeChild(this.canvas.element),e.content.insertBefore(this.canvas.element,r[1].canvas.element)}}},getLayer:function(){return this},remove:function(){var e=this.getStage(),r=this.canvas,o=r.element;Kinetic.Node.prototype.remove.call(this),e&&r&&Kinetic.Type._isInDocument(o)&&e.content.removeChild(o)}},Kinetic.Global.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Node.addGettersSetters(Kinetic.Layer,["clearBeforeDraw"])}(),function(){Kinetic.Group=function(e){this._initGroup(e)},Kinetic.Group.prototype={_initGroup:function(e){this.nodeType="Group",Kinetic.Container.call(this,e)}},Kinetic.Global.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Rect=function(e){this._initRect(e)},Kinetic.Rect.prototype={_initRect:function(e){this.setDefaultAttrs({width:0,height:0,cornerRadius:0}),Kinetic.Shape.call(this,e),this.shapeType="Rect",this._setDrawFuncs()},drawFunc:function(e){var r=e.getContext();r.beginPath();var o=this.getCornerRadius(),i=this.getWidth(),T=this.getHeight();0===o?r.rect(0,0,i,T):(r.moveTo(o,0),r.lineTo(i-o,0),r.arc(i-o,o,o,3*Math.PI/2,0,!1),r.lineTo(i,T-o),r.arc(i-o,T-o,o,0,Math.PI/2,!1),r.lineTo(o,T),r.arc(o,T-o,o,Math.PI/2,Math.PI,!1),r.lineTo(0,o),r.arc(o,o,o,Math.PI,3*Math.PI/2,!1)),r.closePath(),e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Rect,["cornerRadius"])}(),function(){Kinetic.Circle=function(e){this._initCircle(e)},Kinetic.Circle.prototype={_initCircle:function(e){this.setDefaultAttrs({radius:0}),Kinetic.Shape.call(this,e),this.shapeType="Circle",this._setDrawFuncs()},drawFunc:function(e){var r=e.getContext();r.beginPath(),r.arc(0,0,this.getRadius(),0,2*Math.PI,!0),r.closePath(),e.fillStroke(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius(e/2)}},Kinetic.Global.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Circle,["radius"])}(),function(){Kinetic.Wedge=function(e){this._initWedge(e)},Kinetic.Wedge.prototype={_initWedge:function(e){this.setDefaultAttrs({radius:0,angle:0,clockwise:!1}),Kinetic.Shape.call(this,e),this.shapeType="Wedge",this._setDrawFuncs()},drawFunc:function(e){var r=e.getContext();r.beginPath(),r.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),r.lineTo(0,0),r.closePath(),e.fillStroke(this)},setAngleDeg:function(e){this.setAngle(Kinetic.Type._degToRad(e))},getAngleDeg:function(){return Kinetic.Type._radToDeg(this.getAngle())}},Kinetic.Global.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Wedge,["radius","angle","clockwise"])}(),function(){Kinetic.Ellipse=function(e){this._initEllipse(e)},Kinetic.Ellipse.prototype={_initEllipse:function(e){this.setDefaultAttrs({radius:{x:0,y:0}}),Kinetic.Shape.call(this,e),this.shapeType="Ellipse",this._setDrawFuncs()},drawFunc:function(e){var r=e.getContext(),o=this.getRadius();r.beginPath(),r.save(),o.x!==o.y&&r.scale(1,o.y/o.x),r.arc(0,0,o.x,0,2*Math.PI,!0),r.restore(),r.closePath(),e.fillStroke(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius({x:e/2})},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius({y:e/2})}},Kinetic.Global.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Node.addPointGettersSetters(Kinetic.Ellipse,["radius"])}(),function(){Kinetic.Image=function(e){this._initImage(e)},Kinetic.Image.prototype={_initImage:function(e){Kinetic.Shape.call(this,e),this.shapeType="Image",this._setDrawFuncs();var r=this;this.on("imageChange",function(){r._syncSize()}),this._syncSize()},drawFunc:function(e){var r,o=this.getWidth(),i=this.getHeight(),T=this,u=e.getContext();u.beginPath(),u.rect(0,0,o,i),u.closePath(),e.fillStroke(this);if(this.attrs.image){if(this.attrs.crop&&this.attrs.crop.width&&this.attrs.crop.height){var v=this.attrs.crop.x||0,b=this.attrs.crop.y||0,C=this.attrs.crop.width,z=this.attrs.crop.height;r=[this.attrs.image,v,b,C,z,0,0,o,i]}else r=[this.attrs.image,0,0,o,i];this.hasShadow()?e.applyShadow(this,function(){T._drawImage(u,r)}):this._drawImage(u,r)}},drawHitFunc:function(e){var r=this.getWidth(),o=this.getHeight(),i=this.imageHitRegion,T=e.getContext();i?(T.drawImage(i,0,0,r,o),T.beginPath(),T.rect(0,0,r,o),T.closePath(),e.stroke(this)):(T.beginPath(),T.rect(0,0,r,o),T.closePath(),e.fillStroke(this))},applyFilter:function(e,r,o){var i=new Kinetic.Canvas(this.attrs.image.width,this.attrs.image.height),T=i.getContext();T.drawImage(this.attrs.image,0,0);try{var u=T.getImageData(0,0,i.getWidth(),i.getHeight());e(u,r);var v=this;Kinetic.Type._getImage(u,function(e){v.setImage(e),o&&o()})}catch(b){Kinetic.Global.warn("Unable to apply filter. "+b.message)}},setCrop:function(){var e=[].slice.call(arguments),r=Kinetic.Type._getXY(e),o=Kinetic.Type._getSize(e),i=Kinetic.Type._merge(r,o);this.setAttr("crop",Kinetic.Type._merge(i,this.getCrop()))},createImageHitRegion:function(e){var r=new Kinetic.Canvas(this.attrs.width,this.attrs.height),o=r.getContext();o.drawImage(this.attrs.image,0,0);try{for(var i=o.getImageData(0,0,r.getWidth(),r.getHeight()),T=i.data,u=Kinetic.Type._hexToRgb(this.colorKey),v=0,b=T.length;b>v;v+=4)T[v]=u.r,T[v+1]=u.g,T[v+2]=u.b;var C=this;Kinetic.Type._getImage(i,function(r){C.imageHitRegion=r,e&&e()})}catch(z){Kinetic.Global.warn("Unable to create image hit region. "+z.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},_syncSize:function(){this.attrs.image&&(this.attrs.width||this.setWidth(this.attrs.image.width),this.attrs.height||this.setHeight(this.attrs.image.height))},_drawImage:function(e,r){5===r.length?e.drawImage(r[0],r[1],r[2],r[3],r[4]):9===r.length&&e.drawImage(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}},Kinetic.Global.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Image,["image"]),Kinetic.Node.addGetters(Kinetic.Image,["crop"])}(),function(){Kinetic.Polygon=function(e){this._initPolygon(e)},Kinetic.Polygon.prototype={_initPolygon:function(e){this.setDefaultAttrs({points:[]}),Kinetic.Shape.call(this,e),this.shapeType="Polygon",this._setDrawFuncs()},drawFunc:function(e){var r=e.getContext(),o=this.getPoints(),i=o.length;r.beginPath(),r.moveTo(o[0].x,o[0].y);for(var T=1;i>T;T++)r.lineTo(o[T].x,o[T].y);r.closePath(),e.fillStroke(this)},setPoints:function(e){this.setAttr("points",Kinetic.Type._getPoints(e))}},Kinetic.Global.extend(Kinetic.Polygon,Kinetic.Shape),Kinetic.Node.addGetters(Kinetic.Polygon,["points"])}(),function(){function e(e){e.fillText(this.partialText,0,0)}function r(e){e.strokeText(this.partialText,0,0)}var o="auto",i="Calibri",T="canvas",u="center",v="Change.kinetic",b="2d",C="\n",z="",t="left",l="\n",s="text",a="Text",h="top",c="middle",m="normal",d="px ",p=" ",f="right",g=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height"],y=g.length;Kinetic.Text=function(e){this._initText(e)},Kinetic.Text.prototype={_initText:function(u){var b=this;this.setDefaultAttrs({fontFamily:i,text:z,fontSize:12,align:t,verticalAlign:h,fontStyle:m,padding:0,width:o,height:o,lineHeight:1}),this.dummyCanvas=document.createElement(T),Kinetic.Shape.call(this,u),this._fillFunc=e,this._strokeFunc=r,this.shapeType=a,this._setDrawFuncs();for(var C=0;y>C;C++)this.on(g[C]+v,b._setTextData);this._setTextData()},drawFunc:function(e){var r=e.getContext(),o=this.getPadding(),i=this.getFontStyle(),T=this.getFontSize(),v=this.getFontFamily(),b=this.getTextHeight(),C=this.getLineHeight()*b,z=this.textArr,n=z.length,l=this.getWidth();r.font=i+p+T+d+v,r.textBaseline=c,r.textAlign=t,r.save(),r.translate(o,0),r.translate(0,o+b/2);for(var s=0;n>s;s++){var a=z[s],h=a.text,m=a.width;r.save(),this.getAlign()===f?r.translate(l-m-2*o,0):this.getAlign()===u&&r.translate((l-m-2*o)/2,0),this.partialText=h,e.fillStroke(this),r.restore(),r.translate(0,C)}r.restore()},drawHitFunc:function(e){var r=e.getContext(),o=this.getWidth(),i=this.getHeight();r.beginPath(),r.rect(0,0,o,i),r.closePath(),e.fillStroke(this)},setText:function(e){var r=Kinetic.Type._isString(e)?e:""+e;this.setAttr(s,r)},getWidth:function(){return this.attrs.width===o?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===o?this.getTextHeight()*this.textArr.length*this.attrs.lineHeight+2*this.attrs.padding:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(e){var r,o=this.dummyCanvas,i=o.getContext(b),T=this.getFontSize();return i.save(),i.font=this.getFontStyle()+p+T+d+this.getFontFamily(),r=i.measureText(e),i.restore(),{width:r.width,height:parseInt(T,10)}},_expandTextData:function(e){var r=e.length;n=0,text=z,newArr=[];for(n=0;r>n;n++)text=e[n],newArr.push({text:text,width:this._getTextSize(text).width});return newArr},_setTextData:function(){var e=this.getText().split(z),r=[],i=0;addLine=!0,lineHeightPx=0,padding=this.getPadding(),this.textWidth=0,this.textHeight=this._getTextSize(this.getText()).height,lineHeightPx=this.getLineHeight()*this.textHeight;for(;e.length>0&&addLine&&(this.attrs.height===o||this.attrs.height-2*padding>lineHeightPx*(i+1));){var T=0,u=void 0;addLine=!1;for(;e.length>T;){if(e.indexOf(l)===T){e.splice(T,1),u=e.splice(0,T).join(z);break}var v=e.slice(0,T);if(this.attrs.width!==o&&this._getTextSize(v.join(z)).width>this.attrs.width-2*padding){if(0==T)break;var b=v.lastIndexOf(p),n=v.lastIndexOf(C),t=Math.max(b,n);if(t>=0){u=e.splice(0,1+t).join(z);break}u=e.splice(0,T).join(z);break}T++,T===e.length&&(u=e.splice(0,T).join(z))}this.textWidth=Math.max(this.textWidth,this._getTextSize(u).width),void 0!==u&&(r.push(u),addLine=!0),i++}this.textArr=this._expandTextData(r)}},Kinetic.Global.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Text,["fontFamily","fontSize","fontStyle","padding","align","lineHeight"]),Kinetic.Node.addGetters(Kinetic.Text,[s])}(),function(){Kinetic.Line=function(e){this._initLine(e)},Kinetic.Line.prototype={_initLine:function(e){this.setDefaultAttrs({points:[],lineCap:"butt"}),Kinetic.Shape.call(this,e),this.shapeType="Line",this._setDrawFuncs()},drawFunc:function(e){var r=this.getPoints(),o=r.length,i=e.getContext();i.beginPath(),i.moveTo(r[0].x,r[0].y);for(var T=1;o>T;T++){var u=r[T];i.lineTo(u.x,u.y)}e.stroke(this)},setPoints:function(e){this.setAttr("points",Kinetic.Type._getPoints(e))}},Kinetic.Global.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Node.addGetters(Kinetic.Line,["points"])}(),function(){Kinetic.Spline=function(e){this._initSpline(e)},Kinetic.Spline._getControlPoints=function(e,r,o,i){var T=e.x,u=e.y,v=r.x,b=r.y,C=o.x,z=o.y,n=Math.sqrt(Math.pow(v-T,2)+Math.pow(b-u,2)),t=Math.sqrt(Math.pow(C-v,2)+Math.pow(z-b,2)),l=i*n/(n+t),s=i*t/(n+t),a=v-l*(C-T),h=b-l*(z-u),c=v+s*(C-T),m=b+s*(z-u);return[{x:a,y:h},{x:c,y:m}]},Kinetic.Spline.prototype={_initSpline:function(e){this.setDefaultAttrs({tension:1}),Kinetic.Line.call(this,e),this.shapeType="Spline"},drawFunc:function(e){var r=this.getPoints(),o=r.length,i=e.getContext(),T=this.getTension();i.beginPath(),i.moveTo(r[0].x,r[0].y);if(0!==T&&o>2){var u=this.allPoints,v=u.length;i.quadraticCurveTo(u[0].x,u[0].y,u[1].x,u[1].y);for(var b=2;v-1>b;)i.bezierCurveTo(u[b].x,u[b++].y,u[b].x,u[b++].y,u[b].x,u[b++].y);i.quadraticCurveTo(u[v-1].x,u[v-1].y,r[o-1].x,r[o-1].y)}else for(var b=1;o>b;b++){var C=r[b];i.lineTo(C.x,C.y)}e.stroke(this)},setPoints:function(e){Kinetic.Line.prototype.setPoints.call(this,e),this._setAllPoints()},setTension:function(e){this.setAttr("tension",e),this._setAllPoints()},_setAllPoints:function(){for(var e=this.getPoints(),r=e.length,o=this.getTension(),i=[],T=1;r-1>T;T++){var u=Kinetic.Spline._getControlPoints(e[T-1],e[T],e[T+1],o);i.push(u[0]),i.push(e[T]),i.push(u[1])}this.allPoints=i}},Kinetic.Global.extend(Kinetic.Spline,Kinetic.Line),Kinetic.Node.addGetters(Kinetic.Spline,["tension"])}(),function(){Kinetic.Blob=function(e){this._initBlob(e)},Kinetic.Blob.prototype={_initBlob:function(e){Kinetic.Spline.call(this,e),this.shapeType="Blob"},drawFunc:function(e){var r=this.getPoints(),o=r.length,i=e.getContext(),T=this.getTension();i.beginPath(),i.moveTo(r[0].x,r[0].y);if(0!==T&&o>2)for(var u=this.allPoints,v=u.length,b=0;v-1>b;)i.bezierCurveTo(u[b].x,u[b++].y,u[b].x,u[b++].y,u[b].x,u[b++].y);else for(var b=1;o>b;b++){var C=r[b];i.lineTo(C.x,C.y)}i.closePath(),e.fillStroke(this)},_setAllPoints:function(){var e=this.getPoints(),r=e.length,o=this.getTension(),i=Kinetic.Spline._getControlPoints(e[r-1],e[0],e[1],o),T=Kinetic.Spline._getControlPoints(e[r-2],e[r-1],e[0],o);Kinetic.Spline.prototype._setAllPoints.call(this),this.allPoints.unshift(i[1]),this.allPoints.push(T[0]),this.allPoints.push(e[r-1]),this.allPoints.push(T[1]),this.allPoints.push(i[0]),this.allPoints.push(e[0])}},Kinetic.Global.extend(Kinetic.Blob,Kinetic.Spline)}(),function(){Kinetic.Sprite=function(e){this._initSprite(e)},Kinetic.Sprite.prototype={_initSprite:function(e){this.setDefaultAttrs({index:0,frameRate:17}),Kinetic.Shape.call(this,e),this.shapeType="Sprite",this._setDrawFuncs(),this.anim=new Kinetic.Animation;var r=this;this.on("animationChange",function(){r.setIndex(0)})},drawFunc:function(e){var r=this.attrs.animation,o=this.attrs.index,i=this.attrs.animations[r][o],T=e.getContext(),u=this.attrs.image;u&&T.drawImage(u,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},drawHitFunc:function(e){var r=this.attrs.animation,o=this.attrs.index,i=this.attrs.animations[r][o],T=e.getContext();T.beginPath(),T.rect(0,0,i.width,i.height),T.closePath(),e.fill(this)},start:function(){var e=this,r=this.getLayer();this.anim.node=r,this.interval=setInterval(function(){var r=e.attrs.index;e._updateIndex(),e.afterFrameFunc&&r===e.afterFrameIndex&&(e.afterFrameFunc(),delete e.afterFrameFunc,delete e.afterFrameIndex)},1e3/this.attrs.frameRate),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(e,r){this.afterFrameIndex=e,this.afterFrameFunc=r},_updateIndex:function(){var e=this.attrs.index,r=this.attrs.animation;this.attrs.animations[r].length-1>e?this.attrs.index++:this.attrs.index=0}},Kinetic.Global.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Sprite,["animation","animations","index"])}(),function(){Kinetic.Star=function(e){this._initStar(e)},Kinetic.Star.prototype={_initStar:function(e){this.setDefaultAttrs({numPoints:0,innerRadius:0,outerRadius:0}),Kinetic.Shape.call(this,e),this.shapeType="Star",this._setDrawFuncs()},drawFunc:function(e){var r=e.getContext(),o=this.attrs.innerRadius,i=this.attrs.outerRadius,T=this.attrs.numPoints;r.beginPath(),r.moveTo(0,0-this.attrs.outerRadius);for(var u=1;2*T>u;u++){var v=0===u%2?i:o,b=v*Math.sin(u*Math.PI/T),C=-1*v*Math.cos(u*Math.PI/T);r.lineTo(b,C)}r.closePath(),e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Star,["numPoints","innerRadius","outerRadius"])}(),function(){Kinetic.RegularPolygon=function(e){this._initRegularPolygon(e)},Kinetic.RegularPolygon.prototype={_initRegularPolygon:function(e){this.setDefaultAttrs({radius:0,sides:0}),Kinetic.Shape.call(this,e),this.shapeType="RegularPolygon",this._setDrawFuncs()},drawFunc:function(e){var r=e.getContext(),o=this.attrs.sides,i=this.attrs.radius;r.beginPath(),r.moveTo(0,0-i);for(var T=1;o>T;T++){var u=i*Math.sin(2*T*Math.PI/o),v=-1*i*Math.cos(2*T*Math.PI/o);r.lineTo(u,v)}r.closePath(),e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.RegularPolygon,["radius","sides"])
}(),function(){Kinetic.Path=function(e){this._initPath(e)},Kinetic.Path.prototype={_initPath:function(e){this.dataArray=[];var r=this;Kinetic.Shape.call(this,e),this.shapeType="Path",this._setDrawFuncs(),this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange",function(){r.dataArray=Kinetic.Path.parsePathData(r.attrs.data)})},drawFunc:function(e){var r=this.dataArray,o=e.getContext();o.beginPath();for(var i=0;r.length>i;i++){var T=r[i].command,u=r[i].points;switch(T){case"L":o.lineTo(u[0],u[1]);break;case"M":o.moveTo(u[0],u[1]);break;case"C":o.bezierCurveTo(u[0],u[1],u[2],u[3],u[4],u[5]);break;case"Q":o.quadraticCurveTo(u[0],u[1],u[2],u[3]);break;case"A":var v=u[0],b=u[1],C=u[2],z=u[3],n=u[4],t=u[5],l=u[6],s=u[7],a=C>z?C:z,h=C>z?1:C/z,c=C>z?z/C:1;o.translate(v,b),o.rotate(l),o.scale(h,c),o.arc(0,0,a,n,n+t,1-s),o.scale(1/h,1/c),o.rotate(-l),o.translate(-v,-b);break;case"z":o.closePath()}}e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(e,r,o,i){return Math.sqrt((o-e)*(o-e)+(i-r)*(i-r))},Kinetic.Path.getPointOnLine=function(e,r,o,i,T,u,v){void 0===u&&(u=r),void 0===v&&(v=o);var b=(T-o)/(i-r+1e-8),C=Math.sqrt(e*e/(1+b*b));r>i&&(C*=-1);var z,n=b*C;if((v-o)/(u-r+1e-8)===b)z={x:u+C,y:v+n};else{var t,l,s=this.getLineLength(r,o,i,T);if(1e-8>s)return void 0;var a=(u-r)*(i-r)+(v-o)*(T-o);a/=s*s,t=r+a*(i-r),l=o+a*(T-o);var h=this.getLineLength(u,v,t,l),c=Math.sqrt(e*e-h*h);C=Math.sqrt(c*c/(1+b*b)),r>i&&(C*=-1),n=b*C,z={x:t+C,y:l+n}}return z},Kinetic.Path.getPointOnCubicBezier=function(e,r,o,i,T,u,v,b,C){function z(e){return e*e*e}function n(e){return 3*e*e*(1-e)}function t(e){return 3*e*(1-e)*(1-e)}function l(e){return(1-e)*(1-e)*(1-e)}var s=b*z(e)+u*n(e)+i*t(e)+r*l(e),a=C*z(e)+v*n(e)+T*t(e)+o*l(e);return{x:s,y:a}},Kinetic.Path.getPointOnQuadraticBezier=function(e,r,o,i,T,u,v){function b(e){return e*e}function C(e){return 2*e*(1-e)}function z(e){return(1-e)*(1-e)}var n=u*b(e)+i*C(e)+r*z(e),t=v*b(e)+T*C(e)+o*z(e);return{x:n,y:t}},Kinetic.Path.getPointOnEllipticalArc=function(e,r,o,i,T,u){var v=Math.cos(u),b=Math.sin(u),C={x:o*Math.cos(T),y:i*Math.sin(T)};return{x:e+(C.x*v-C.y*b),y:r+(C.x*b+C.y*v)}},Kinetic.Path.parsePathData=function(e){if(!e)return[];var r=e,o=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];r=r.replace(RegExp(" ","g"),",");for(var i=0;o.length>i;i++)r=r.replace(RegExp(o[i],"g"),"|"+o[i]);for(var T=r.split("|"),u=[],v=0,b=0,i=1;T.length>i;i++){var C=T[i],z=C.charAt(0);C=C.slice(1),C=C.replace(RegExp(",-","g"),"-"),C=C.replace(RegExp("-","g"),",-"),C=C.replace(RegExp("e,-","g"),"e-");var n=C.split(",");n.length>0&&""===n[0]&&n.shift();for(var t=0;n.length>t;t++)n[t]=parseFloat(n[t]);for(;n.length>0&&!isNaN(n[0]);){var l=null,s=[],a=v,h=b;switch(z){case"l":v+=n.shift(),b+=n.shift(),l="L",s.push(v,b);break;case"L":v=n.shift(),b=n.shift(),s.push(v,b);break;case"m":v+=n.shift(),b+=n.shift(),l="M",s.push(v,b),z="l";break;case"M":v=n.shift(),b=n.shift(),l="M",s.push(v,b),z="L";break;case"h":v+=n.shift(),l="L",s.push(v,b);break;case"H":v=n.shift(),l="L",s.push(v,b);break;case"v":b+=n.shift(),l="L",s.push(v,b);break;case"V":b=n.shift(),l="L",s.push(v,b);break;case"C":s.push(n.shift(),n.shift(),n.shift(),n.shift()),v=n.shift(),b=n.shift(),s.push(v,b);break;case"c":s.push(v+n.shift(),b+n.shift(),v+n.shift(),b+n.shift()),v+=n.shift(),b+=n.shift(),l="C",s.push(v,b);break;case"S":var c=v,m=b,d=u[u.length-1];"C"===d.command&&(c=v+(v-d.points[2]),m=b+(b-d.points[3])),s.push(c,m,n.shift(),n.shift()),v=n.shift(),b=n.shift(),l="C",s.push(v,b);break;case"s":var c=v,m=b,d=u[u.length-1];"C"===d.command&&(c=v+(v-d.points[2]),m=b+(b-d.points[3])),s.push(c,m,v+n.shift(),b+n.shift()),v+=n.shift(),b+=n.shift(),l="C",s.push(v,b);break;case"Q":s.push(n.shift(),n.shift()),v=n.shift(),b=n.shift(),s.push(v,b);break;case"q":s.push(v+n.shift(),b+n.shift()),v+=n.shift(),b+=n.shift(),l="Q",s.push(v,b);break;case"T":var c=v,m=b,d=u[u.length-1];"Q"===d.command&&(c=v+(v-d.points[0]),m=b+(b-d.points[1])),v=n.shift(),b=n.shift(),l="Q",s.push(c,m,v,b);break;case"t":var c=v,m=b,d=u[u.length-1];"Q"===d.command&&(c=v+(v-d.points[0]),m=b+(b-d.points[1])),v+=n.shift(),b+=n.shift(),l="Q",s.push(c,m,v,b);break;case"A":var p=n.shift(),f=n.shift(),g=n.shift(),y=n.shift(),_=n.shift(),P=v,w=b;v=n.shift(),b=n.shift(),l="A",s=this.convertEndpointToCenterParameterization(P,w,v,b,y,_,p,f,g);break;case"a":var p=n.shift(),f=n.shift(),g=n.shift(),y=n.shift(),_=n.shift(),P=v,w=b;v+=n.shift(),b+=n.shift(),l="A",s=this.convertEndpointToCenterParameterization(P,w,v,b,y,_,p,f,g)}u.push({command:l||z,points:s,start:{x:a,y:h},pathLength:this.calcLength(a,h,l||z,s)})}("z"===z||"Z"===z)&&u.push({command:"z",points:[],start:void 0,pathLength:0})}return u},Kinetic.Path.calcLength=function(e,r,o,i){var T,u,v,b=Kinetic.Path;switch(o){case"L":return b.getLineLength(e,r,i[0],i[1]);case"C":T=0,u=b.getPointOnCubicBezier(0,e,r,i[0],i[1],i[2],i[3],i[4],i[5]);for(t=.01;1>=t;t+=.01)v=b.getPointOnCubicBezier(t,e,r,i[0],i[1],i[2],i[3],i[4],i[5]),T+=b.getLineLength(u.x,u.y,v.x,v.y),u=v;return T;case"Q":T=0,u=b.getPointOnQuadraticBezier(0,e,r,i[0],i[1],i[2],i[3]);for(t=.01;1>=t;t+=.01)v=b.getPointOnQuadraticBezier(t,e,r,i[0],i[1],i[2],i[3]),T+=b.getLineLength(u.x,u.y,v.x,v.y),u=v;return T;case"A":T=0;var C=i[4],z=i[5],n=i[4]+z,l=Math.PI/180;l>Math.abs(C-n)&&(l=Math.abs(C-n)),u=b.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],C,0);if(0>z)for(t=C-l;t>n;t-=l)v=b.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),T+=b.getLineLength(u.x,u.y,v.x,v.y),u=v;else for(t=C+l;n>t;t+=l)v=b.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),T+=b.getLineLength(u.x,u.y,v.x,v.y),u=v;return v=b.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],n,0),T+=b.getLineLength(u.x,u.y,v.x,v.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(e,r,o,i,T,u,v,b,C){var z=C*(Math.PI/180),n=Math.cos(z)*(e-o)/2+Math.sin(z)*(r-i)/2,t=-1*Math.sin(z)*(e-o)/2+Math.cos(z)*(r-i)/2,l=n*n/(v*v)+t*t/(b*b);l>1&&(v*=Math.sqrt(l),b*=Math.sqrt(l));var s=Math.sqrt((v*v*b*b-v*v*t*t-b*b*n*n)/(v*v*t*t+b*b*n*n));T==u&&(s*=-1),isNaN(s)&&(s=0);var a=s*v*t/b,h=s*-b*n/v,c=(e+o)/2+Math.cos(z)*a-Math.sin(z)*h,m=(r+i)/2+Math.sin(z)*a+Math.cos(z)*h,d=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},p=function(e,r){return(e[0]*r[0]+e[1]*r[1])/(d(e)*d(r))},f=function(e,r){return(e[0]*r[1]<e[1]*r[0]?-1:1)*Math.acos(p(e,r))},g=f([1,0],[(n-a)/v,(t-h)/b]),y=[(n-a)/v,(t-h)/b],_=[(-1*n-a)/v,(-1*t-h)/b],P=f(y,_);return-1>=p(y,_)&&(P=Math.PI),p(y,_)>=1&&(P=0),0===u&&P>0&&(P-=2*Math.PI),1==u&&0>P&&(P+=2*Math.PI),[c,m,v,b,g,P,z,u]},Kinetic.Node.addGettersSetters(Kinetic.Path,["data"])}(),function(){function e(e){e.fillText(this.partialText,0,0)}function r(e){e.strokeText(this.partialText,0,0)}Kinetic.TextPath=function(e){this._initTextPath(e)},Kinetic.TextPath.prototype={_initTextPath:function(o){this.setDefaultAttrs({fontFamily:"Calibri",fontSize:12,fontStyle:"normal",text:""}),this.dummyCanvas=document.createElement("canvas"),this.dataArray=[];var i=this;Kinetic.Shape.call(this,o),this._fillFunc=e,this._strokeFunc=r,this.shapeType="TextPath",this._setDrawFuncs(),this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange",function(){i.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});for(var T=["text","textStroke","textStrokeWidth"],u=0;T.length>u;u++){var v=T[u];this.on(v+"Change",i._setTextData)}i._setTextData()},drawFunc:function(e){var r=(this.charArr,e.getContext());r.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily,r.textBaseline="middle",r.textAlign="left",r.save();for(var o=this.glyphInfo,i=0;o.length>i;i++){r.save();var T=o[i].p0;o[i].p1,parseFloat(this.attrs.fontSize);r.translate(T.x,T.y),r.rotate(o[i].rotation),this.partialText=o[i].text,e.fillStroke(this),r.restore()}r.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(e){Kinetic.Text.prototype.setText.call(this,e)},_getTextSize:function(e){var r=this.dummyCanvas,o=r.getContext("2d");o.save(),o.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily;var i=o.measureText(e);return o.restore(),{width:i.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var e=this,r=this._getTextSize(this.attrs.text);this.textWidth=r.width,this.textHeight=r.height,this.glyphInfo=[];for(var o,i,T,u=this.attrs.text.split(""),v=-1,b=0,C=function(){b=0;for(var r=e.dataArray,i=v+1;r.length>i;i++){if(r[i].pathLength>0)return v=i,r[i];"M"==r[i].command&&(o={x:r[i].points[0],y:r[i].points[1]})}return{}},z=function(r){var u=e._getTextSize(r).width,v=0,z=0;i=void 0;for(;Math.abs(u-v)/u>.01&&25>z;){z++;for(var n=v;void 0===T;)T=C(),T&&u>n+T.pathLength&&(n+=T.pathLength,T=void 0);if(T==={}||void 0===o)return void 0;var t=!1;switch(T.command){case"L":Kinetic.Path.getLineLength(o.x,o.y,T.points[0],T.points[1])>u?i=Kinetic.Path.getPointOnLine(u,o.x,o.y,T.points[0],T.points[1],o.x,o.y):T=void 0;break;case"A":var l=T.points[4],s=T.points[5],a=T.points[4]+s;0===b?b=l+1e-8:u>v?b+=Math.PI/180*s/Math.abs(s):b-=Math.PI/360*s/Math.abs(s),Math.abs(b)>Math.abs(a)&&(b=a,t=!0),i=Kinetic.Path.getPointOnEllipticalArc(T.points[0],T.points[1],T.points[2],T.points[3],b,T.points[6]);break;case"C":0===b?b=u>T.pathLength?1e-8:u/T.pathLength:u>v?b+=(u-v)/T.pathLength:b-=(v-u)/T.pathLength,b>1&&(b=1,t=!0),i=Kinetic.Path.getPointOnCubicBezier(b,T.start.x,T.start.y,T.points[0],T.points[1],T.points[2],T.points[3],T.points[4],T.points[5]);break;case"Q":0===b?b=u/T.pathLength:u>v?b+=(u-v)/T.pathLength:b-=(v-u)/T.pathLength,b>1&&(b=1,t=!0),i=Kinetic.Path.getPointOnQuadraticBezier(b,T.start.x,T.start.y,T.points[0],T.points[1],T.points[2],T.points[3])}void 0!==i&&(v=Kinetic.Path.getLineLength(o.x,o.y,i.x,i.y)),t&&(t=!1,T=void 0)}},n=0;u.length>n;n++){z(u[n]);if(void 0===o||void 0===i)break;var t=Kinetic.Path.getLineLength(o.x,o.y,i.x,i.y),l=0,s=Kinetic.Path.getPointOnLine(l+t/2,o.x,o.y,i.x,i.y),a=Math.atan2(i.y-o.y,i.x-o.x);this.glyphInfo.push({transposeX:s.x,transposeY:s.y,text:u[n],rotation:a,p0:o,p1:i}),o=i}}},Kinetic.Global.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.TextPath,["fontFamily","fontSize","fontStyle"]),Kinetic.Node.addGetters(Kinetic.TextPath,["text"])}();